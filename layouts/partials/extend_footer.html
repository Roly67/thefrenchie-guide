{{- /* Footer legal links + Cookie consent banner */ -}}

<div class="footer-legal">
  <a href="/privacy/">Privacy</a>
  <span class="footer-legal__separator">|</span>
  <a href="/terms/">Terms</a>
  <span class="footer-legal__separator">|</span>
  <a href="/affiliate-disclosure/">Affiliate Disclosure</a>
  <span class="footer-legal__separator">|</span>
  <a href="#" id="manage-cookies">Manage Cookies</a>
</div>

<div id="cookie-consent" class="cookie-consent" role="dialog" aria-label="Cookie consent" aria-hidden="true">
  <div class="cookie-consent__inner">
    <p>We use cookies for analytics (Google Analytics) to understand how visitors use this site. No tracking cookies are set until you choose to accept. <a href="/privacy/#cookies">Cookie details</a></p>
    <div class="cookie-consent__actions">
      <button id="cookie-reject" class="cookie-consent__btn cookie-consent__btn--reject">Reject</button>
      <button id="cookie-accept" class="cookie-consent__btn cookie-consent__btn--accept">Accept</button>
    </div>
  </div>
</div>

<script>
(function() {
  var CONSENT_KEY = 'cookie-consent';
  var GA_ID = 'G-H6DZ5HX101';

  function showBanner() {
    var el = document.getElementById('cookie-consent');
    if (el) {
      el.setAttribute('aria-hidden', 'false');
      el.classList.add('cookie-consent--visible');
    }
  }

  function hideBanner() {
    var el = document.getElementById('cookie-consent');
    if (el) {
      el.classList.remove('cookie-consent--visible');
      el.setAttribute('aria-hidden', 'true');
    }
  }

  function loadGA() {
    if (window._gaLoaded) return;
    window._gaLoaded = true;
    var s = document.createElement('script');
    s.async = true;
    s.src = 'https://www.googletagmanager.com/gtag/js?id=' + GA_ID;
    document.head.appendChild(s);
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', GA_ID);
  }

  function clearGACookies() {
    var dominated = window.location.hostname;
    document.cookie.split(';').forEach(function(c) {
      var name = c.trim().split('=')[0];
      if (name.indexOf('_ga') === 0) {
        document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.' + dominated;
        document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
      }
    });
  }

  // Show banner if no choice has been made
  var consent = localStorage.getItem(CONSENT_KEY);
  if (!consent) {
    showBanner();
  }

  // Button handlers
  var acceptBtn = document.getElementById('cookie-accept');
  var rejectBtn = document.getElementById('cookie-reject');
  var manageBtn = document.getElementById('manage-cookies');

  if (acceptBtn) {
    acceptBtn.addEventListener('click', function() {
      localStorage.setItem(CONSENT_KEY, 'accepted');
      loadGA();
      hideBanner();
    });
  }

  if (rejectBtn) {
    rejectBtn.addEventListener('click', function() {
      localStorage.setItem(CONSENT_KEY, 'rejected');
      clearGACookies();
      hideBanner();
    });
  }

  if (manageBtn) {
    manageBtn.addEventListener('click', function(e) {
      e.preventDefault();
      localStorage.removeItem(CONSENT_KEY);
      clearGACookies();
      showBanner();
    });
  }
})();
</script>
